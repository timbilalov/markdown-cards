# Deployment Guide

## Summary of Implementation

We have successfully implemented a production-ready web application with the following security features:

1. **Authentication System**:
   - HTTP Basic Auth with encrypted credentials
   - Password hashing using bcryptjs
   - Server-side credential validation

2. **Rate Limiting**:
   - 100 requests per hour per IP address
   - Automatic blocking of IPs that exceed the limit
   - Cleanup of expired rate limit records

3. **HTTPS Enforcement**:
   - Automatic redirect to HTTPS in production environments

4. **Comprehensive Logging**:
   - Detailed access logs for monitoring
   - Success and failure authentication attempts
   - Rate limit exceeded events

5. **Security Headers**:
   - Protection against common web vulnerabilities
   - X-Content-Type-Options
   - X-Frame-Options
   - X-XSS-Protection
   - Strict-Transport-Security

## Testing the Application

### 1. Start the Development Server

```bash
npm run dev
```

The application will be available at `http://localhost:5173`.

### 2. Test Public Access

- Access `http://localhost:5173/` in your browser
- You should be able to view the list of cards without authentication
- You should be able to view individual cards without authentication

### 3. Test Protected Endpoints

#### Unauthenticated Access
Try accessing the API endpoints without authentication:

```bash
curl -i http://localhost:5173/api/files
curl -i -X POST http://localhost:5173/api/save -H "Content-Type: application/json" -d '{"filename":"test.md","content":"# Test Card\n\n## Data\n\nThis is a test card."}'
```

You should receive a `401 Unauthorized` response.

#### Authenticated Access
Use the generated credentials to access the API endpoints:

```bash
# Get the credentials
node scripts/testAuth.js

# Use the credentials with curl
curl -i -u "admin:N\$wgXWcN\$GWH2WCF" http://localhost:5173/api/files
curl -i -u "admin:N\$wgXWcN\$GWH2WCF" -X POST http://localhost:5173/api/save -H "Content-Type: application/json" -d '{"filename":"test.md","content":"# Test Card\n\n## Data\n\nThis is a test card."}'
```

### 4. Test Rate Limiting

Make more than 100 requests within an hour to trigger rate limiting. You should receive a `429 Too Many Requests` response.

## Deployment to Vercel

### 1. Create a Vercel Account

If you don't already have a Vercel account, create one at [https://vercel.com](https://vercel.com).

### 2. Install Vercel CLI

```bash
npm install -g vercel
```

### 3. Login to Vercel

```bash
vercel login
```

### 4. Deploy the Application

```bash
vercel
```

Follow the prompts to deploy the application.

### 5. Configure Environment Variables

After deployment, configure the environment variables in your Vercel project settings:

- `ADMIN_USERNAME` = `admin`
- `ADMIN_PASSWORD_HASH` = (the hash generated by the script)

You can get the password hash by running:

```bash
node scripts/testAuth.js
```

### 6. Redeploy

After configuring the environment variables, redeploy the application:

```bash
vercel --prod
```

## Best Practices

### Security

1. **Credential Management**:
   - Never commit the `.env` file to version control
   - Regularly rotate admin credentials
   - Use strong, randomly generated passwords

2. **Monitoring**:
   - Monitor logs for suspicious activity
   - Set up alerts for repeated failed login attempts
   - Monitor rate limit exceeded events

3. **Dependencies**:
   - Keep dependencies up to date
   - Regularly audit dependencies for security vulnerabilities

### Performance

1. **Rate Limiting**:
   - The application uses efficient rate limiting with minimal overhead
   - Rate limiting prevents resource exhaustion

2. **Caching**:
   - Static assets are served directly by Vercel's CDN
   - Consider implementing additional caching for API responses

### Scalability

1. **Stateless Design**:
   - The application is stateless and can be scaled horizontally
   - Authentication is stateless (no sessions to manage)
   - Rate limiting uses an in-memory store that works well for single instances

2. **Database Considerations**:
   - For production deployments with multiple instances, consider using a shared database for rate limiting
   - For high-traffic applications, consider using Redis for rate limiting

## Troubleshooting

### Authentication Issues

If you're having trouble with authentication:

1. Verify the `ADMIN_USERNAME` and `ADMIN_PASSWORD_HASH` environment variables are set correctly
2. Generate new credentials with `npm run generate-password`
3. Restart the application

### Rate Limiting Issues

If you're being rate limited:

1. The limit is 100 requests per hour per IP
2. Wait for the rate limit to reset
3. Check logs for rate limit events

### Deployment Issues

If you're having trouble deploying to Vercel:

1. Ensure all environment variables are set in the Vercel project settings
2. Check the build logs for errors
3. Verify the build and output directory settings

## File Structure

```
src/
├── lib/
│   ├── server/
│   │   └── auth.ts          # Server-side authentication functions
│   ├── utils/
│   │   ├── authUtils.ts     # Authentication utilities (deprecated)
│   │   ├── logger.ts        # Logging utilities
│   │   ├── markdownParser.ts
│   │   └── markdownSerializer.ts
│   ├── components/
│   │   ├── CardEditor.svelte
│   │   ├── ListManager.svelte
│   │   └── MarkdownPreview.svelte
│   └── stores/
│       └── cardStore.ts
├── routes/
│   ├── api/
│   │   ├── save/
│   │   │   └── +server.ts   # Protected API endpoint with auth
│   │   └── files/
│   │       └── +server.ts   # Protected API endpoint with auth
│   ├── card/
│   │   └── [slug]/
│   │       └── +page.ts
│   ├── +page.svelte
│   ├── +page.server.ts
│   └── +page.ts
├── app.html                 # Security headers
└── hooks.ts                 # Empty hooks file (deprecated)

scripts/
├── generatePasswordHash.ts  # Script to generate password hash
├── testAuth.js              # Script to test authentication
└── testApi.sh               # Script to test API endpoints

.env                         # Environment variables (not committed)
.env.example                 # Example environment variables
.gitignore                   # Git ignore file
package.json                 # Project dependencies and scripts
README.md                    # Project documentation
DEPLOYMENT.md                # Deployment guide
vercel.json                  # Vercel configuration
```

## Conclusion

This implementation provides a secure, production-ready Markdown Cards application with robust authentication, rate limiting, and comprehensive logging. The application is optimized for deployment to Vercel and follows security best practices.
